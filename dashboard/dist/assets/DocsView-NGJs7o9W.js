import{u as y,r as m,j as i}from"./index-khSP0IRw.js";import"./vendor-DDxydHEc.js";function S({onSelectFile:n}){const t=y(s=>s.docs),r=y(s=>s.setDocs),[e,a]=m.useState([]),[l,f]=m.useState(null),[c,o]=m.useState(!0),d=t.currentFile;return m.useEffect(()=>{let s=!1;async function u(){o(!0),f(null);try{const p=await fetch("/api/docs");if(!p.ok){s||f("ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨");return}const x=await p.json();if(s)return;const v=x.docs??[];if(a(v),!d){const b=v.find(j=>j.exists);b&&n(b.name)}}catch{s||f("ì„œë²„ ì—°ê²° ì‹¤íŒ¨")}finally{s||o(!1)}}return u(),()=>{s=!0}},[]),m.useEffect(()=>{if(!t.loading)return;let s=!1;async function u(){try{const p=await fetch("/api/docs");if(!p.ok||s)return;const x=await p.json();s||(a(x.docs??[]),r({loading:!1}))}catch{s||r({loading:!1})}}return u(),()=>{s=!0}},[t.loading,r]),c?i.jsx("div",{style:{padding:"8px 6px",fontSize:11,color:"var(--muted-foreground)"},children:"ë¡œë”© ì¤‘..."}):l?i.jsx("div",{style:{padding:"8px 6px",fontSize:11,color:"var(--destructive)"},children:l}):e.length===0?i.jsx("div",{style:{padding:"8px 6px",fontSize:11,color:"var(--muted-foreground)"},children:"ë¬¸ì„œ ì—†ìŒ"}):i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:1},children:e.map(s=>{const u=d===s.name,p=!s.exists;return i.jsxs("div",{role:s.exists?"button":void 0,tabIndex:s.exists?0:void 0,"aria-pressed":u?!0:void 0,onClick:s.exists?()=>n(s.name):void 0,onKeyDown:s.exists?x=>{(x.key==="Enter"||x.key===" ")&&(x.preventDefault(),n(s.name))}:void 0,style:{display:"flex",alignItems:"center",gap:6,padding:"7px 10px",borderRadius:6,fontSize:11,cursor:s.exists?"pointer":"default",opacity:p?.4:1,pointerEvents:p?"none":"auto",background:u?"rgba(88,166,255,0.12)":"transparent",color:u?"var(--primary)":"var(--muted-foreground)",fontWeight:u?600:400,transition:"background 0.15s, color 0.15s",wordBreak:"break-all",lineHeight:1.4},children:[i.jsx("span",{style:{flexShrink:0,fontSize:12},children:"ðŸ“„"}),i.jsx("span",{children:s.displayName??s.name})]},s.name)})})}function h(n){return String(n).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function w(n){const t=n.match(/^---\r?\n([\s\S]*?)\r?\n---\r?\n?([\s\S]*)$/);return t?{frontmatter:t[1].trim(),body:t[2]}:{frontmatter:null,body:n}}function g(n){return n.replace(/\*\*(.+?)\*\*|__(.+?)__/g,(t,r,e)=>`<strong>${r||e}</strong>`).replace(/\*(.+?)\*|_(.+?)_/g,(t,r,e)=>`<em>${r||e}</em>`).replace(/`([^`]+)`/g,(t,r)=>`<code>${r}</code>`)}function $(n){if(n.length<2)return`<p>${h(n.join(`
`))}</p>`;const t=f=>/^\s*\|[\s:|-]+\|\s*$/.test(f),r=n[0],e=n.length>=2&&t(n[1]),a=f=>f.replace(/^\s*\|/,"").replace(/\|\s*$/,"").split("|").map(c=>c.trim());let l="<table>";if(e){const f=a(r);l+="<thead><tr>",f.forEach(c=>{l+=`<th>${g(h(c))}</th>`}),l+="</tr></thead>",l+="<tbody>";for(let c=2;c<n.length;c++){if(t(n[c]))continue;const o=a(n[c]);l+="<tr>",o.forEach(d=>{l+=`<td>${g(h(d))}</td>`}),l+="</tr>"}l+="</tbody>"}else l+="<tbody>",n.forEach(f=>{if(t(f))return;const c=a(f);l+="<tr>",c.forEach(o=>{l+=`<td>${g(h(o))}</td>`}),l+="</tr>"}),l+="</tbody>";return l+="</table>",l}function k(n){const t=n.split(`
`);let r="",e=0;for(;e<t.length;){const a=t[e];if(a.trimStart().startsWith("```")){const o=a.trimStart().slice(3).trim(),d=[];for(e++;e<t.length&&!t[e].trimStart().startsWith("```");)d.push(h(t[e])),e++;r+=`<pre><code${o?` class="lang-${h(o)}"`:""}>${d.join(`
`)}</code></pre>`,e++;continue}if(/^(\s*[-*_]){3,}\s*$/.test(a)){r+="<hr>",e++;continue}const l=a.match(/^(#{1,6})\s+(.+)$/);if(l){const o=l[1].length,d=g(h(l[2]));r+=`<h${o}>${d}</h${o}>`,e++;continue}if(a.includes("|")&&a.trimStart().startsWith("|")){const o=[];for(;e<t.length&&t[e].trimStart().startsWith("|");)o.push(t[e]),e++;r+=$(o);continue}if(a.match(/^(\s*)[-*+]\s+(.*)$/)){for(r+="<ul>";e<t.length;){const o=t[e].match(/^(\s*)[-*+]\s+(.*)$/);if(!o)break;const d=o[2],s=d.match(/^\[([ xX])\]\s+(.*)$/);if(s){const u=s[1].toLowerCase()==="x",p=g(h(s[2]));r+=`<li class="task-list-item"><input type="checkbox" class="task-checkbox"${u?" checked":""} disabled><span>${p}</span></li>`}else r+=`<li>${g(h(d))}</li>`;e++}r+="</ul>";continue}if(a.match(/^(\s*)\d+\.\s+(.*)$/)){for(r+="<ol>";e<t.length;){const o=t[e].match(/^(\s*)\d+\.\s+(.*)$/);if(!o)break;r+=`<li>${g(h(o[2]))}</li>`,e++}r+="</ol>";continue}if(a.trim()===""){r+="<p></p>",e++;continue}r+=`<p>${g(h(a))}</p>`,e++}return r}function _(n){return n?k(n):""}function E(n){return n.split(`
`).map(t=>{const r=t.indexOf(":");return r===-1?null:{key:t.slice(0,r).trim(),value:t.slice(r+1).trim()}}).filter(t=>t!==null&&t.key.length>0)}function D({filename:n}){const t=y(o=>o.docs),r=y(o=>o.setDocs);if(m.useEffect(()=>{if(!n)return;let o=!1;async function d(){r({loading:!0,content:null});try{const s=await fetch(`/api/docs/${encodeURIComponent(n)}`);if(o)return;if(!s.ok){const p=await s.json().catch(()=>({}));o||r({loading:!1,content:`__ERROR__:${p.message??"íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"}`});return}const u=await s.json();o||r({loading:!1,content:u.content??"",currentFile:u.filename,files:t.files})}catch{o||r({loading:!1,content:"__ERROR__:ì„œë²„ ì—°ê²° ì‹¤íŒ¨"})}}return(t.content===null||t.currentFile!==n)&&d(),()=>{o=!0}},[n,t.content===null]),!n)return i.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:10,color:"var(--muted-foreground)",textAlign:"center",padding:40},children:[i.jsx("span",{style:{fontSize:48,opacity:.4},children:"ðŸ“„"}),i.jsx("span",{style:{fontSize:14,fontWeight:600},children:"íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”"}),i.jsx("span",{style:{fontSize:12,opacity:.6,maxWidth:280,lineHeight:1.5},children:"ì¢Œì¸¡ ëª©ë¡ì—ì„œ ë¬¸ì„œë¥¼ í´ë¦­í•˜ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤"})]});if(t.loading&&t.content===null)return i.jsx("div",{style:{padding:20,color:"var(--muted-foreground)",fontSize:12},children:"ë¡œë”© ì¤‘..."});if(t.content?.startsWith("__ERROR__:")){const o=t.content.slice(10);return i.jsxs("div",{style:{padding:20,color:"var(--destructive)",fontSize:13},children:["ì˜¤ë¥˜: ",o]})}const e=t.content??"",{frontmatter:a,body:l}=w(e),f=_(l),c=a?E(a):[];return i.jsx("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:i.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"16px 20px",scrollbarWidth:"thin",scrollbarColor:"var(--border) transparent"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12,marginBottom:16,paddingBottom:12,borderBottom:"1px solid var(--border)"},children:[i.jsxs("span",{style:{fontSize:12,fontWeight:600,color:"var(--foreground)"},children:["ðŸ“„ ",h(n)]}),t.currentFile===n&&i.jsx("span",{style:{fontSize:11,color:"var(--muted-foreground)"}})]}),c.length>0&&i.jsxs("div",{style:{marginBottom:16,background:"rgba(88,166,255,0.05)",border:"1px solid rgba(88,166,255,0.15)",borderRadius:6,padding:"10px 14px",fontSize:12},children:[i.jsx("div",{style:{fontSize:10,fontWeight:700,textTransform:"uppercase",letterSpacing:"0.8px",color:"var(--muted-foreground)",marginBottom:8},children:"Frontmatter"}),i.jsx("table",{style:{borderCollapse:"collapse",width:"100%"},children:i.jsx("tbody",{children:c.map(({key:o,value:d})=>i.jsxs("tr",{children:[i.jsx("td",{style:{padding:"3px 8px 3px 0",color:"var(--primary)",fontWeight:600,whiteSpace:"nowrap",verticalAlign:"top",fontSize:11},children:o}),i.jsx("td",{style:{padding:"3px 0",color:"var(--muted-foreground)",fontSize:11,wordBreak:"break-word"},children:d})]},o))})})]}),i.jsx("div",{className:"md-content",dangerouslySetInnerHTML:{__html:f}})]})})}function W(){const n=y(e=>e.docs),t=y(e=>e.setDocs),r=m.useCallback(e=>{t({currentFile:e,content:null})},[t]);return i.jsxs("div",{style:{flex:1,display:"flex",overflow:"hidden",height:"100%"},children:[i.jsxs("div",{style:{width:160,flexShrink:0,borderRight:"1px solid var(--border)",overflowY:"auto",padding:"12px 8px",scrollbarWidth:"thin",scrollbarColor:"var(--border) transparent"},children:[i.jsx("div",{style:{fontSize:10,fontWeight:700,textTransform:"uppercase",letterSpacing:"0.8px",color:"var(--muted-foreground)",padding:"0 2px 8px"},children:"Documents"}),i.jsx(S,{onSelectFile:r})]}),i.jsx("div",{style:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column"},children:i.jsx(D,{filename:n.currentFile})})]})}export{W as DocsView};
